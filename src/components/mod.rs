use self::bus::Bus;
use self::dh6502::M6502;
use self::types::M6502AddrModes;
use self::types::M6502Opcodes;

pub mod bus;
pub mod clock;
pub mod dh6502;
pub mod types;

const BOTTOM_OF_RAM: u16 = 0x0000;
const TOP_OF_RAM: u16 = 0xFFFF;

// 6502 lookup table
// for logging but may be left alone for now
const LOOKUP_TABLE: [(
    &'static str,
    for<'a, 'b> fn(&'a mut M6502, &'b mut Bus) -> u8,
    for<'a, 'b> fn(&'a mut M6502, &'b mut Bus) -> u8,
    u8,
); 256] = [
    ("BRK", M6502::brk, M6502::imm, 7),
    ("ORA", M6502::ora, M6502::izx, 6),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 3),
    ("ORA", M6502::ora, M6502::zp0, 3),
    ("ASL", M6502::asl, M6502::zp0, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("PHP", M6502::php, M6502::imp, 3),
    ("ORA", M6502::ora, M6502::imm, 2),
    ("ASL", M6502::asl, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::nop, M6502::imp, 4),
    ("ORA", M6502::ora, M6502::abs, 4),
    ("ASL", M6502::asl, M6502::abs, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("BPL", M6502::bpl, M6502::rel, 2),
    ("ORA", M6502::ora, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 4),
    ("ORA", M6502::ora, M6502::zpx, 4),
    ("ASL", M6502::asl, M6502::zpx, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("CLC", M6502::clc, M6502::imp, 2),
    ("ORA", M6502::ora, M6502::aby, 4),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 4),
    ("ORA", M6502::ora, M6502::abx, 4),
    ("ASL", M6502::asl, M6502::abx, 7),
    ("???", M6502::xxx, M6502::imp, 7),
    ("JSR", M6502::jsr, M6502::abs, 6),
    ("AND", M6502::and, M6502::izx, 6),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("BIT", M6502::bit, M6502::zp0, 3),
    ("AND", M6502::and, M6502::zp0, 3),
    ("ROL", M6502::rol, M6502::zp0, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("PLP", M6502::plp, M6502::imp, 4),
    ("AND", M6502::and, M6502::imm, 2),
    ("ROL", M6502::rol, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("BIT", M6502::bit, M6502::abs, 4),
    ("AND", M6502::and, M6502::abs, 4),
    ("ROL", M6502::rol, M6502::abs, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("BMI", M6502::bmi, M6502::rel, 2),
    ("AND", M6502::and, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 4),
    ("AND", M6502::and, M6502::zpx, 4),
    ("ROL", M6502::rol, M6502::zpx, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("SEC", M6502::sec, M6502::imp, 2),
    ("AND", M6502::and, M6502::aby, 4),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 4),
    ("AND", M6502::and, M6502::abx, 4),
    ("ROL", M6502::rol, M6502::abx, 7),
    ("???", M6502::xxx, M6502::imp, 7),
    ("RTI", M6502::rti, M6502::imp, 6),
    ("EOR", M6502::eor, M6502::izx, 6),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 3),
    ("EOR", M6502::eor, M6502::zp0, 3),
    ("LSR", M6502::lsr, M6502::zp0, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("PHA", M6502::pha, M6502::imp, 3),
    ("EOR", M6502::eor, M6502::imm, 2),
    ("LSR", M6502::lsr, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("JMP", M6502::jmp, M6502::abs, 3),
    ("EOR", M6502::eor, M6502::abs, 4),
    ("LSR", M6502::lsr, M6502::abs, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("BVC", M6502::bvc, M6502::rel, 2),
    ("EOR", M6502::eor, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 4),
    ("EOR", M6502::eor, M6502::zpx, 4),
    ("LSR", M6502::lsr, M6502::zpx, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("CLI", M6502::cli, M6502::imp, 2),
    ("EOR", M6502::eor, M6502::aby, 4),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 4),
    ("EOR", M6502::eor, M6502::abx, 4),
    ("LSR", M6502::lsr, M6502::abx, 7),
    ("???", M6502::xxx, M6502::imp, 7),
    ("RTS", M6502::rts, M6502::imp, 6),
    ("ADC", M6502::adc, M6502::izx, 6),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 3),
    ("ADC", M6502::adc, M6502::zp0, 3),
    ("ROR", M6502::ror, M6502::zp0, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("PLA", M6502::pla, M6502::imp, 4),
    ("ADC", M6502::adc, M6502::imm, 2),
    ("ROR", M6502::ror, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("JMP", M6502::jmp, M6502::ind, 5),
    ("ADC", M6502::adc, M6502::abs, 4),
    ("ROR", M6502::ror, M6502::abs, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("BVS", M6502::bvs, M6502::rel, 2),
    ("ADC", M6502::adc, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 4),
    ("ADC", M6502::adc, M6502::zpx, 4),
    ("ROR", M6502::ror, M6502::zpx, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("SEI", M6502::sei, M6502::imp, 2),
    ("ADC", M6502::adc, M6502::aby, 4),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 4),
    ("ADC", M6502::adc, M6502::abx, 4),
    ("ROR", M6502::ror, M6502::abx, 7),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 2),
    ("STA", M6502::sta, M6502::izx, 6),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 6),
    ("STY", M6502::sty, M6502::zp0, 3),
    ("STA", M6502::sta, M6502::zp0, 3),
    ("STX", M6502::stx, M6502::zp0, 3),
    ("???", M6502::xxx, M6502::imp, 3),
    ("DEY", M6502::dey, M6502::imp, 2),
    ("???", M6502::nop, M6502::imp, 2),
    ("TXA", M6502::txa, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("STY", M6502::sty, M6502::abs, 4),
    ("STA", M6502::sta, M6502::abs, 4),
    ("STX", M6502::stx, M6502::abs, 4),
    ("???", M6502::xxx, M6502::imp, 4),
    ("BCC", M6502::bcc, M6502::rel, 2),
    ("STA", M6502::sta, M6502::izy, 6),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 6),
    ("STY", M6502::sty, M6502::zpx, 4),
    ("STA", M6502::sta, M6502::zpx, 4),
    ("STX", M6502::stx, M6502::zpy, 4),
    ("???", M6502::xxx, M6502::imp, 4),
    ("TYA", M6502::tya, M6502::imp, 2),
    ("STA", M6502::sta, M6502::aby, 5),
    ("TXS", M6502::txs, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 5),
    ("???", M6502::nop, M6502::imp, 5),
    ("STA", M6502::sta, M6502::abx, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("LDY", M6502::ldy, M6502::imm, 2),
    ("LDA", M6502::lda, M6502::izx, 6),
    ("LDX", M6502::ldx, M6502::imm, 2),
    ("???", M6502::xxx, M6502::imp, 6),
    ("LDY", M6502::ldy, M6502::zp0, 3),
    ("LDA", M6502::lda, M6502::zp0, 3),
    ("LDX", M6502::ldx, M6502::zp0, 3),
    ("???", M6502::xxx, M6502::imp, 3),
    ("TAY", M6502::tay, M6502::imp, 2),
    ("LDA", M6502::lda, M6502::imm, 2),
    ("TAX", M6502::tax, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("LDY", M6502::ldy, M6502::abs, 4),
    ("LDA", M6502::lda, M6502::abs, 4),
    ("LDX", M6502::ldx, M6502::abs, 4),
    ("???", M6502::xxx, M6502::imp, 4),
    ("BCS", M6502::bcs, M6502::rel, 2),
    ("LDA", M6502::lda, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 5),
    ("LDY", M6502::ldy, M6502::zpx, 4),
    ("LDA", M6502::lda, M6502::zpx, 4),
    ("LDX", M6502::ldx, M6502::zpy, 4),
    ("???", M6502::xxx, M6502::imp, 4),
    ("CLV", M6502::clv, M6502::imp, 2),
    ("LDA", M6502::lda, M6502::aby, 4),
    ("TSX", M6502::tsx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 4),
    ("LDY", M6502::ldy, M6502::abx, 4),
    ("LDA", M6502::lda, M6502::abx, 4),
    ("LDX", M6502::ldx, M6502::aby, 4),
    ("???", M6502::xxx, M6502::imp, 4),
    ("CPY", M6502::cpy, M6502::imm, 2),
    ("CMP", M6502::cmp, M6502::izx, 6),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("CPY", M6502::cpy, M6502::zp0, 3),
    ("CMP", M6502::cmp, M6502::zp0, 3),
    ("DEC", M6502::dec, M6502::zp0, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("INY", M6502::iny, M6502::imp, 2),
    ("CMP", M6502::cmp, M6502::imm, 2),
    ("DEX", M6502::dex, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 2),
    ("CPY", M6502::cpy, M6502::abs, 4),
    ("CMP", M6502::cmp, M6502::abs, 4),
    ("DEC", M6502::dec, M6502::abs, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("BNE", M6502::bne, M6502::rel, 2),
    ("CMP", M6502::cmp, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 4),
    ("CMP", M6502::cmp, M6502::zpx, 4),
    ("DEC", M6502::dec, M6502::zpx, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("CLD", M6502::cld, M6502::imp, 2),
    ("CMP", M6502::cmp, M6502::aby, 4),
    ("NOP", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 4),
    ("CMP", M6502::cmp, M6502::abx, 4),
    ("DEC", M6502::dec, M6502::abx, 7),
    ("???", M6502::xxx, M6502::imp, 7),
    ("CPX", M6502::cpx, M6502::imm, 2),
    ("SBC", M6502::sbc, M6502::izx, 6),
    ("???", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("CPX", M6502::cpx, M6502::zp0, 3),
    ("SBC", M6502::sbc, M6502::zp0, 3),
    ("INC", M6502::inc, M6502::zp0, 5),
    ("???", M6502::xxx, M6502::imp, 5),
    ("INX", M6502::inx, M6502::imp, 2),
    ("SBC", M6502::sbc, M6502::imm, 2),
    ("NOP", M6502::nop, M6502::imp, 2),
    ("???", M6502::sbc, M6502::imp, 2),
    ("CPX", M6502::cpx, M6502::abs, 4),
    ("SBC", M6502::sbc, M6502::abs, 4),
    ("INC", M6502::inc, M6502::abs, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("BEQ", M6502::beq, M6502::rel, 2),
    ("SBC", M6502::sbc, M6502::izy, 5),
    ("???", M6502::xxx, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 8),
    ("???", M6502::nop, M6502::imp, 4),
    ("SBC", M6502::sbc, M6502::zpx, 4),
    ("INC", M6502::inc, M6502::zpx, 6),
    ("???", M6502::xxx, M6502::imp, 6),
    ("SED", M6502::sed, M6502::imp, 2),
    ("SBC", M6502::sbc, M6502::aby, 4),
    ("NOP", M6502::nop, M6502::imp, 2),
    ("???", M6502::xxx, M6502::imp, 7),
    ("???", M6502::nop, M6502::imp, 4),
    ("SBC", M6502::sbc, M6502::abx, 4),
    ("INC", M6502::inc, M6502::abx, 7),
    ("???", M6502::xxx, M6502::imp, 7),
];
